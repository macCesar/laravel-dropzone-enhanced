# Changelog

All notable changes to `laravel-dropzone-enhanced` will be documented in this file.

## 1.4.3 - 2025-07-05 ⚠️ CRITICAL HOTFIX

### Fixed
- **CRITICAL**: Fixed breaking change that crashed existing installations without `user_id` column
- Added `Schema::hasColumn()` checks before attempting to use `user_id` field
- `DropzoneController` now works with or without `user_id` column in table
- Photo creation only includes `user_id` if column exists in database
- Permission checks handle missing `user_id` column gracefully
- Full backward compatibility restored for existing installations

### Security
- This hotfix resolves the unacceptable oversight of requiring a database field without ensuring backward compatibility

## 1.4.2 - 2025-07-05

### Added
- **Automatic migrations**: Added migration to update existing `photos` table with `user_id` column
- Database migrations now load automatically via ServiceProvider - no manual publishing required
- Migration includes safeguards to avoid conflicts if column already exists

### Improved
- Enhanced user experience: users no longer need to manually create table structure updates
- Better backward compatibility with existing installations

## 1.4.1 - 2025-07-05

### Added
- **Native thumbnail generation**: Restored automatic thumbnail creation using GD extension
- Added `ImageProcessor` service class for standalone image processing
- Thumbnails are now generated during upload without external dependencies

### Fixed
- Fixed double slash issue in generated URLs using rtrim()
- Restored missing thumbnail generation functionality that was lost in v1.4.0
- Thumbnails now properly appear in the dropzone preview area

### Changed
- Updated composer.json description to reflect standalone functionality
- Removed Laravel Glide Enhanced suggestion from composer dependencies
- Upload process now generates thumbnails using native PHP GD extension

### Technical Details
- Uses GD extension for image processing (crop and resize)
- Supports JPEG, PNG, GIF, and WebP formats
- Maintains aspect ratio with center crop for thumbnails
- Preserves transparency for PNG/GIF images
- Configurable quality settings via config file

## 1.4.0 - 2025-07-05

### ⚠️ BREAKING CHANGES
- **Removed all Laravel Glide Enhanced integration**: Package now works completely independently
- **Removed dynamic thumbnail generation**: Only static thumbnails are supported
- **Removed `serveImage` method and route**: No longer serves processed images

### Removed
- Integration detection with Laravel Glide Enhanced in Photo model
- Dynamic thumbnail generation using Glide in upload process
- `serveImage()` method from DropzoneController
- `/dropzone/image/{path}` route
- Glide-related documentation from README

### Changed
- `getUrl()` method now only uses Laravel Storage (no dynamic processing)
- `getThumbnailUrl()` method now only serves static thumbnails or original image
- Storage disk configuration reverted to simple 'public' (no external dependencies)
- Upload process no longer attempts to create processed thumbnails
- README updated to reflect standalone functionality

### Notes
- **For dynamic image processing**: Use Laravel Glide Enhanced as a separate, independent package
- **For static thumbnails**: Thumbnails must be generated by your application separately
- **Migration**: If you relied on automatic Glide integration, implement it manually in your application
- This change eliminates all compatibility issues and makes the package truly standalone

## 1.3.2 - 2025-07-05

### Fixed
- **BREAKING FIX**: Fixed image loading issues when using with Laravel Glide Enhanced
- Unified disk configuration to use `config('images.disk')` for better compatibility

### Changed
- Storage disk configuration now falls back to Laravel Glide Enhanced disk setting
- Improved package integration by standardizing disk configuration
- Enhanced compatibility with Laravel Glide Enhanced v2.0.0+

### Notes
- If you have both packages installed, they will now use the same disk automatically
- This eliminates the "broken images" issue when both packages coexist
- **Migration**: If you had custom `dropzone.storage.disk`, ensure `images.disk` is set correctly

## 1.3.1 - 2025-07-05

### Changed
- Updated Laravel Glide Enhanced integration examples to use new `/glide/` prefix
- Updated README documentation to reflect Laravel Glide Enhanced v2.0.0 compatibility
- Fixed srcset examples in advanced usage section

### Notes
- No functional changes - only documentation updates
- Fully compatible with Laravel Glide Enhanced v2.0.0
- Automatic integration continues to work seamlessly

## 1.3.0 - 2025-04-12

### Added
- Added comprehensive authorization options for photo deletion
- Added `security` section to configuration with `allow_all_authenticated_users` and `access_key` options
- Added support for X-Access-Key header for API authorization
- Added multiple ownership validation methods (user relationship, isAdmin, Gates, Spatie Permissions)
- Added detailed documentation on all authorization methods in README
- Added new configuration options for image processing in `dropzone.php`, including default dimensions, quality settings, and thumbnail configuration
- Added improved drag-and-drop functionality using Sortable.js in `photos.blade.php`

### Changed
- Enhanced error messages in the `destroy` method with detailed context information
- Updated `userCanDeletePhoto` method with more robust permission checks
- Changed README to use GitHub Issues instead of email for support requests
- Improved security by removing personal contact information from documentation
- Refactored `area.blade.php` to streamline Dropzone initialization and improve error handling
- Updated `lightbox.blade.php` to simplify lightbox functionality and improve accessibility
- Enhanced `photos.blade.php` with new styles for photo actions
- Modified `web.php` to adjust route prefixes and middleware for Dropzone routes
- Improved DropzoneController with enhanced authorization checks for photo deletion and main photo setting

### Fixed
- Fixed session token validation to check both model ID and photo ID formats
- Improved error handling for unauthorized deletion attempts

## 1.2.2 - 2025-07-05

### Changed
- Updated Laravel Glide Enhanced integration examples to use new `/glide/` prefix
- Updated README documentation to reflect Laravel Glide Enhanced v2.0.0 compatibility
- Fixed srcset examples in advanced usage section

### Notes
- No functional changes - only documentation updates
- Fully compatible with Laravel Glide Enhanced v2.0.0
- Automatic integration continues to work seamlessly

## 1.2.1 - 2025-04-12

### Added
- Enhanced security for photo deletion with ownership verification
- Added `userCanDeletePhoto` method to verify permissions before photo deletion

### Changed
- Improved authorization checks in the `destroy` method for better security

## 1.2.0 - 2025-04-11

### Added
- Improved error handling with detailed error messages
- Enhanced client-side resizing configuration
- More flexible configuration defaults from config file

### Changed
- Removed default `/admin` route prefix for greater flexibility
- Changed default middleware to only use `web` (without `auth`)
- Improved client-side validation and error display
- Updated documentation with comprehensive configuration examples

### Fixed
- Fixed empty file data sent to server during upload
- Corrected duplicate error handler in Dropzone initialization
- Improved handling of large file uploads
- Fixed installation command prompt issue

## 1.1.0 - 2025-04-11

### Added
- New `checkIsMain` endpoint to verify if an image is marked as the main one
- Toggle capability for the main image button (activate/deactivate)
- Visual indicator for drag function (drag handle)

### Fixed
- Fixed URL generation to use relative paths instead of absolute ones
- Corrected image proportion in thumbnails with `object-fit: contain`
- Improved user interface for reordering images

## 1.0.0 - 2025-04-11

### Added
- Initial release with core functionality
- Dropzone.js integration with local assets (version 6.0.0-beta.2)
- Photo model with polymorphic relationships
- HasPhotos trait for model integration
- Image processing with Laravel Glide Enhanced (optional)
- Thumbnail generation
- Photo reordering with drag and drop
- Main photo selection
- Photo deletion
- Lightbox for image viewing
- Blade components for easy integration
- Multi-language support (English and Spanish)
- Comprehensive documentation
- Installation command

### Configuration Options
- Route prefix and middleware
- Storage disk and directory
- Image dimensions and quality
- Thumbnail settings
- Pre-resize options
